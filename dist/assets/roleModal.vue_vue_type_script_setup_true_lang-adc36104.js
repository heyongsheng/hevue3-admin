import{d as N,e as u,r as h,o as T,k as B,w as n,g as r,B as C,h as o,i as L,a7 as q,Q as I,C as j,D as M,p as U,q as $,aq as H,ar as O}from"./index-5f3dae94.js";import{E as P}from"./overlay-e3278dbe.js";import{E as Q}from"./tree-c449bbfd.js";import"./checkbox-e441c6b3.js";const S=N({__name:"roleModal",props:["menuData"],emits:["reloadList"],setup(b,{expose:y,emit:V}){const x=b,R={children:"children",label:"title"},d=u(!1),s=h({role_name:""}),c=u(),p=u(""),v=u(),E=h({role_name:[{required:!0,message:"请输入角色名称",trigger:["blur","change"]}]}),i=u(),F=async l=>{if(d.value=!0,await q(),l){Object.keys(s).forEach(a=>{s[a]=l[a]||s[a]});let e=l.role_permission;(e?e.split(","):[]).map(a=>{let t=i.value.getNode(a);t.isLeaf&&i.value.setChecked(t,!0)}),c.value=l._id,p.value="编辑角色"}else p.value="添加角色",c.value=""},k=u(!1),w=l=>{l==null||l.validate().then(()=>{const e=i.value.getCheckedKeys(),_=i.value.getHalfCheckedKeys(),a=[...e,..._];let t,f={...s,role_permission:a.join(",")};c.value?(t=H,f._id=c.value):t=O,k.value=!0,t(f).then(()=>{k.value=!1,I.success({title:"成功",message:p.value+"成功"}),d.value=!1,V("reloadList")})})},D=()=>{var l;(l=v.value)==null||l.resetFields()};return y({showModal:F}),(l,e)=>{const _=j,a=M,t=Q,f=U,g=$,K=P;return T(),B(K,{title:o(p),modelValue:o(d),"onUpdate:modelValue":e[3]||(e[3]=m=>L(d)?d.value=m:null),onClose:D},{footer:n(()=>[r(g,{onClick:e[1]||(e[1]=m=>d.value=!1)},{default:n(()=>[C("取消")]),_:1}),r(g,{loading:o(k),type:"primary",onClick:e[2]||(e[2]=m=>w(o(v)))},{default:n(()=>[C("确定")]),_:1},8,["loading"])]),default:n(()=>[r(f,{model:o(s),"label-width":"100px",rules:o(E),ref_key:"addFormRef",ref:v},{default:n(()=>[r(a,{label:"角色名称：",prop:"role_name"},{default:n(()=>[r(_,{modelValue:o(s).role_name,"onUpdate:modelValue":e[0]||(e[0]=m=>o(s).role_name=m),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),r(a,{label:"角色权限：",prop:"gender"},{default:n(()=>[r(t,{ref_key:"menuTreeRef",ref:i,data:x.menuData,props:R,"show-checkbox":"","node-key":"_id","default-expand-all":""},null,8,["data"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])}}});export{S as _};
